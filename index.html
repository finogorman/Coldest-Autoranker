<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Coldest Autoranker — Elo</title>
<style>
  :root{--line:#e5e5e5;--muted:#666}
  *{box-sizing:border-box}
  body{font:14px/1.45 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#fff;color:#111}
  header{border-bottom:1px solid var(--line);padding:12px 16px;font-weight:700}
  main{max-width:1200px;margin:16px auto;padding:0 16px;display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
  @media (max-width:980px){main{grid-template-columns:1fr}}
  .panel{border:1px solid var(--line);border-radius:10px;overflow:hidden;background:#fff}
  .panel h2{margin:0;padding:10px 12px;border-bottom:1px solid var(--line);font-size:16px}
  .muted{color:var(--muted);font-size:12px;margin:8px 12px}
  .table-wrap{max-height:70vh;overflow:auto}
  table{width:100%;border-collapse:collapse}
  th,td{padding:8px 10px;border-bottom:1px solid var(--line);text-align:left}
  th{position:sticky;top:0;background:#fafafa;z-index:1}
  td.rank{width:52px;color:#333}
  td.song{font-weight:600}
  td.artist{color:var(--muted)}
  td.elo, td.rec, td.gp{white-space:nowrap;text-align:right}
  .vote-body{padding:12px}
  .vote-title{font-weight:700;margin:0 0 4px}
  .vote-sub{color:var(--muted);margin:0 0 12px}
  .choices{display:grid;gap:10px}
  .choice{border:1px solid var(--line);border-radius:10px;padding:14px;cursor:pointer}
  .choice:hover{outline:2px solid #e3edff;border-color:#c6d9ff}
  .song-title{font-weight:700}
  .song-artist{color:var(--muted)}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:10px 0}
  button{padding:8px 10px;border-radius:8px;border:1px solid var(--line);background:#f6f6f6;cursor:pointer}
  button.primary{background:#e8f0ff;border-color:#b9d0ff}
  progress{height:14px}
</style>
<body>
<header>Coldest Autoranker — Elo</header>
<main>
  <!-- Left: Rankings -->
  <section class="panel" id="rankPanel">
    <h2>Rankings</h2>
    <div class="muted" id="status">Ready</div>
    <div class="table-wrap">
      <table id="rankTable">
        <thead>
          <tr>
            <th>Rank</th><th>Song</th><th>Artist</th>
            <th>Elo</th><th>W-L-T</th><th>GP</th>
          </tr>
        </thead>
        <tbody id="rankTbody"></tbody>
      </table>
    </div>
  </section>

  <!-- Right: Vote -->
  <section class="panel">
    <h2>Vote</h2>
    <div class="vote-body">
      <p class="vote-title">Which song do you prefer?</p>
      <p class="vote-sub">Click a box or press <b>1</b>, <b>2</b>, or <b>T</b> for tie.</p>
      <div class="choices">
        <div class="choice" id="leftChoice">
          <div class="song-title" id="leftTitle"></div>
          <div class="song-artist" id="leftArtist"></div>
          <div class="muted">Pick: 1</div>
        </div>
        <div class="choice" id="rightChoice">
          <div class="song-title" id="rightTitle"></div>
          <div class="song-artist" id="rightArtist"></div>
          <div class="muted">Pick: 2</div>
        </div>
      </div>

      <div class="row">
        <button id="tieBtn">Tie (T)</button>
        <button id="undoBtn">Undo</button>
        <button id="exportBtn">Export CSV</button>
        <button id="resetBtn">Reset</button>
      </div>
      <div class="row">
        <progress id="prog" max="1" value="0"></progress>
        <span class="muted" id="progTxt">0 votes</span>
      </div>
    </div>
  </section>
</main>

<script>
/* ---------------- Songs ---------------- */
const rawSongs = [
"Feelin' Love - Euphoria Mix* — 22 Interns, Entasia",
"Hold On — 49th & Main, Shee",
"Gimme! Gimme! Gimme! (A Man After Midnight) — ABBA",
"Shoot to Thrill — AC/DC",
"Raving In The Studio — Aitch, Bou",
"Happiness - IN2STELLAR Edit* — Alexis Jordan, IN2STELLAR",
"A Horse With No Name — America",
"Back to Black — Amy Winehouse",
"So Close — Ango",
"I Want Your Soul — Armand Van Helden",
"You Don't Know Me - Radio Edit — Armand Van Helden, Duane Harden",
"Friday (Alone Right Now) — ATRIP",
"The Nights — Avicii",
"Airplanes — B.o.B, Hayley Williams",
"Cherub — Ball Park Music",
"Good Grief — Bastille",
"Frosty — Bebe Stockwell",
"Rust — Ben Böhmer",
"Weightless - jamesjamesjames Remix — Ben Böhmer, Panama, jamesjamesjames",
"Halo — Beyoncé",
"Lanterns — Birds of Tokyo",
"Don't Lie — Black Eyed Peas",
"Meet Me Halfway — Black Eyed Peas",
"Champagne Coast — Blood Orange",
"Mind Loaded — Blood Orange, Caroline Polachek, Lorde, Mustafa",
"The Field — Blood Orange, The Durutti Column, Tariq Al-Sabir, Caroline Polachek, Daniel Caesar",
"From — Bon Iver",
"Make Me - Paul Sirrell Remix — Borai & Denham Audio, Paul Sirrell",
"Missing You — Boston Bun",
"I'm On Fire — Bruce Springsteen",
"Move Your Body — bullet tooth, Xpansions",
"Telling You to Love Me — Butschi",
"Run Away (I Can't Hold You) — CAIVA",
"I'm Not Alone (Radio Edit) — Calvin Harris",
"You Used to Hold Me — Calvin Harris",
"Blessings - KETTAMA Remix — Calvin Harris, Clementine Douglas, KETTAMA",
"I'm Not Alone - MPH Remix — Calvin Harris, MPH",
"CRG — Central Cee, Dave",
"Green Dove — Chaos In The CBD",
"Talk talk — Charli xcx",
"Think I'm In Love With You — Chris Stapleton",
"You Should Probably Leave — Chris Stapleton",
"Desire — Chris Stussy",
"Calendoola — Cloak Bay",
"Come With Me (On a Trip) — Clouds",
"N13 — Cody Wong",
"Hymn for the Weekend — Coldplay",
"Heartbreaker — Crazy P",
"Rain — Creed",
"Bad Moon Rising — Creedence Clearwater Revival",
"Gold BBS — CRUSH3d",
"Something About Us — Daft Punk",
"I Can Wait — Danmic's",
"Emergency — Dart",
"The Color Violet — DATSKO",
"Gettin' Over — David Guetta, Chris Willis, Fergie",
"Runaway - ENW Vs. Darren Jey Mix — Davinah, Darren Jey, ENW",
"Don't Go Away — Demi Riquísimo, The Trip",
"Outnumbered — Dermot Kennedy",
"Baby! — Dijon",
"The Dress — Dijon",
"Latch — Disclosure, Sam Smith",
"Staring Into The Sun — DJ HEARTSTRING",
"Forever (if u need it) — DJ HEARTSTRING, SWIM",
"Wanna Feel — DJ IP & Pegassi",
"Groovejet (If This Ain't Love) — Dj Spiller, Sophie Ellis-Bextor",
"King of Everything — Dominic Fike",
"Skin to Skin — Douvelle19, Kaisha",
"Rain — Dragon",
"Take It Easy — Eagles",
"Tondoho Mba — Eko Roosevelt",
"What U Want - Chris Stussy & Djoko a.k.A Kolter Remix — Enrico Mantini, X Woman, Chris Stussy, Kolter",
"Mona — Entasia",
"Heather Park — Ewan McVicar",
"Crazy — False Persona, Mall Grab",
"Everywhere — Fleetwood Mac",
"The Chain — Fleetwood Mac",
"Stranded — Flight Facilities, BROODS, Reggie Watts, Saro",
"Bug — Fontaines D.C.",
"It's Amazing To Be Young — Fontaines D.C.",
"Call It What You Want — Foster the People",
"Seigfried — Frank Ocean",
"Take Me Out — Franz Ferdinand",
"Tate (how i feel) — Fred again..",
"The Heart Is a Muscle — Gang of Youths",
"Taxes — Geese",
"Tweaker — GELO",
"Keep Me Waiting — George Michelle, Seperate Ways",
"Bamboléo — Gipsy Kings",
"Holiday — Green Day",
"Welcome to the Jungle — Guns N' Roses",
"Battle Scars — Guy Sebastian, Lupe Fiasco",
"What Is Love - 7\" Mix — Haddaway",
"The Nosebleed Section — Hilltop Hoods",
"Benediction — Hot Natured",
"Weathervane — Hunter Metts",
"Do You See What I See? — Hunters & Collectors",
"Holy Grail — Hunters & Collectors",
"Tana’s Home — Idi Akz",
"Perfect Storm — Inhaler",
"You Might Get What You Want — Inhaler",
"Superstar — Jamelia",
"Broken Strings — James Morrison, Nelly Furtado",
"(Don't) Give Hate a Chance — Jamiroquai",
"Domino — Jessie J",
"tell you straight — jigitz",
"Working Class Man — Jimmy Barnes",
"Take Me Home, Country Roads — John Denver",
"Feelings - Radio Edit — John Mood, Janis Zielinski",
"Edge of Desire — Jonas Blue, Malive",
"Love Will Tear Us Apart — Joy Division",
"Lippy — Joy Orbison, Overmono, Skiifall",
"Phantom Pt. II - Soulwax Remix — Justice, Soulwax",
"DAISIES — Justin Bieber",
"Ruby — Kaiser Chiefs",
"ILYSMIH — Kali Uchis",
"Can't Tell Me Nothing — Kanye West",
"Paranoid — Kanye West, Mr Hudson",
"Chemical Thing - Bliss Inc. Remix — Kara Okay, Rob Black, Bliss Inc",
"Underdog — Kasabian",
"I Remember - Radio Edit — Kaskade, deadmau5",
"Somewhere Only We Know — Keane",
"It Gets Better - Forever Mix — KETTAMA",
"3AM - DATSKO Edit* — KETTAMA, DATSKO",
"Yosemite — KETTAMA, Interplanetary Criminal",
"Don't Stop - drums & acid mix — KI/KI",
"All Summer Long — Kid Rock",
"Bette Davis Eyes — Kim Carnes",
"Closer — Kings of Leon",
"Radioactive — Kings of Leon",
"Revelry — Kings of Leon",
"Waste a Moment — Kings of Leon",
"Feel My Desire — Kyle Starkey",
"Timeworn Tech — Kyra Khaldi",
"Bulletproof — La Roux",
"Andromedha* — Lachie Senior",
"My Delirium — Ladyhawke",
"All My Friends — LCD Soundsystem",
"Everything's Electric — Liam Gallagher",
"Baby Pluto — Lil Uzi Vert",
"T.D — Lil Yachty, Tierra Whack, A$AP Rocky, Tyler, The Creator",
"Bleed It Out — Linkin Park",
"What Was That — Lorde",
"Want You In My Soul — Lovebirds, Stee Downes",
"Working for the Weekend — Loverboy",
"all i need — Loyle Carner",
"Where the Wild Things Are — Luke Combs",
"Scotty Doesn't Know — Lustra",
"Dive — Mall Grab",
"Life — Mall Grab",
"Want My Love — Malugi, WOLTERS",
"Dance with Somebody - Radio Version — Mando Diao",
"Freakin' - Original — Marc Romboy, Blake Baxter",
"MJB Da MVP - Alternate Version — Mary J. Blige, 50 Cent",
"DARLING DRIVE — METTE, Sam Gellaitry",
"Lemon Grass — MF DOOM",
"GTA San Adreas Theme - IMMINENT Edit* — Michael Hunter, IMMINENT",
"Dreamworld — Midnight Oil",
"Forgotten Years — Midnight Oil",
"Paddling Out — Miike Snow",
"Cooler Than Me - Single Mix — Mike Posner, Gigamesh",
"See You Again — Miley Cyrus",
"DNM — Mk.gee",
"ROCKMAN — Mk.gee",
"Porcelain — Moby",
"Rollercoaster — Modjo",
"I'm The Problem — Morgan Wallen",
"Just In Case — Morgan Wallen",
"The Future - Purple Disco Machine Remix — Motez, Antony & Cleopatra, Purple Disco Machine",
"Harry and the Jets — Mouseatouille",
"Hopeless Wanderer — Mumford & Sons",
"I Will Wait — Mumford & Sons",
"Snake Eyes — Mumford & Sons",
"You Get What You Give — New Radicals",
"Dream Catch Me — Newton Faulkner",
"I Need You - Twofaced Sport Mix* — Nikita Warren, Twofaced",
"Skyscrapers — Nina Kraviz",
"Acquiesce (Remastered) — Oasis",
"You're Not Alone — Olive",
"Nice To Each Other — Olivia Dean",
"Counting Stars — OneRepublic",
"4EVA — Ordley",
"Gem Lingo (ovr now) — Overmono, Ruthven",
"Turn the Page — Overmono, The Streets",
"Let's Go Swimming — Palace",
"The Sun — Parov Stelar, Graham Candy",
"Picture in my mind — PinkPantheress, Sam Gellaitry",
"Give Me Everything — Pitbull, AFROJACK, Ne-Yo, Nayer",
"Wax — Pocket",
"death bed (coffee for your head) — Powfu, beabadoobee",
"MONDAY — Quadeca",
"Final Answer - Mike Momburg Remix — Radio Cargo, Astrid James, Mike Momburg",
"Empty Words — Radio Free Alice",
"Look What You've Done — Radio Free Alice",
"High and Dry — Radiohead",
"Diamonds - Big Daddy 2022 Bootleg* — Rihanna, DJ Big Daddy From Oslo",
"Her Diamonds — Rob Thomas",
"Show Me Love — Robin S.",
"Dancing On My Own — Robyn",
"Fried Rice — Royel Otis",
"Kool Aid — Royel Otis",
"Like an Animal — RÜFÜS DU SOL",
"Say a Prayer For Me — RÜFÜS DU SOL",
"This Summer — RÜFÜS DU SOL",
"Touch Me - Radio Edit — Rui Da Silva, Cassandra",
"Kiss of Life — Sade",
"Straight and Narrow — Sam Barber",
"All Is On My Side — Sam Fender",
"Hypersonic Missiles — Sam Fender",
"Rein Me In — Sam Fender, Olivia Dean",
"925 — Sammy Virji, Chris Lake, RoRo",
"Arabest — SebastiAn",
"Feel Da Same — Silva Bumpa, Carla Monroe",
"Back 2 Back — Skepta, Fred again..",
"Where You Need To Be — Skin On Skin",
"back to friends — sombr",
"It Feels so Good - The Conductor & the Cowboy Amnesia Mix — Sonique",
"Black Hole Sun — Soundgarden",
"Look Right Through - MK Vocal Edit — Storm Queen, MK",
"Different Time — Swimming Paul",
"Psycho Killer — Talking Heads",
"Somebody Else — The 1975",
"Hey You — The Belair Lip Bombs",
"Look The Part — The Belair Lip Bombs",
"Rock the Casbah (Ranking Roger) — The Clash",
"GO — The Kid LAROI, Juice WRLD",
"All These Things That I've Done — The Killers",
"When You Were Young — The Killers",
"Bad Habit — The Kooks",
"Run Your Mouth — The Marías",
"Such Great Heights — The Postal Service",
"Heaven's on Fire — The Radio Dept.",
"Night Light — The Rions",
"Hall of Fame — The Script, will.i.am",
"Trembling Hands — The Temper Trap",
"Wide open Road — The Triffids",
"Fake Friends — The Vanns",
"Bitter Sweet Symphony — The Verve",
"Under the Pressure — The War on Drugs",
"In The Summertime — Thirsty Merc",
"Mousetrap Heart — Thirsty Merc",
"Need To Know — Tommy Holohan",
"Let me go OH OH — Tove Lo, SG Lewis",
"City of Blinding Lights — U2",
"Vertigo — U2",
"Where the Streets Have No Name — U2",
"Born Slippy (Nuxx) — Underworld",
"Another 9 Days — Vegyn, Ethan P. Flynn",
"mangetout — Wet Leg",
"Drama On The Edge — Willaris. K, Hxxd Gxld",
"Like This — William Kiss",
"Take My Mind — WizTheMc, bees & honey",
"Midas — Wunderhorse",
"Silver — Wunderhorse",
"Teal — Wunderhorse",
"You're Not a Popstar — X CLUB.",
"One More Time (I Need U) — Y U QT",
"You Know What I Want — Y U QT",
"We Come Running — Youngblood Hawke",
"Control — Zoe Wees",
];

/* ---------------- Elo engine ---------------- */
const K = 24; // K-factor
let votes = 0;
let items = []; // {id,title,artist,elo,gp,w,l,t}
let lastMatch = null; // for undo

/* ---------------- UI refs ---------------- */
const tbody = document.getElementById('rankTbody');
const statusEl = document.getElementById('status');
const leftBox = document.getElementById('leftChoice');
const rightBox = document.getElementById('rightChoice');
const lTitle = document.getElementById('leftTitle');
const lArtist = document.getElementById('leftArtist');
const rTitle = document.getElementById('rightTitle');
const rArtist = document.getElementById('rightArtist');
const undoBtn = document.getElementById('undoBtn');
const tieBtn = document.getElementById('tieBtn');
const resetBtn = document.getElementById('resetBtn');
const exportBtn = document.getElementById('exportBtn');
const prog = document.getElementById('prog');
const progTxt = document.getElementById('progTxt');

/* ---------------- Events ---------------- */
leftBox.onclick = () => vote('L');
rightBox.onclick = () => vote('R');
tieBtn.onclick = () => vote('T');
undoBtn.onclick = undo;
resetBtn.onclick = () => { localStorage.removeItem('eloRanker'); location.reload(); };
exportBtn.onclick = exportCSV;

window.addEventListener('keydown', e => {
  const k = e.key.toLowerCase();
  if (k==='1') vote('L');
  else if (k==='2') vote('R');
  else if (k==='t') vote('T');
  else if (k==='u') undo();
});

/* ---------------- Init ---------------- */
loadOrSeed();
renderRankings();
pickAndRenderPair();

/* ---------------- Functions ---------------- */
function loadOrSeed(){
  const saved = localStorage.getItem('eloRanker');
  if (saved){
    try {
      const s = JSON.parse(saved);
      items = s.items; votes = s.votes; lastMatch = null;
      status('Restored');
      return;
    } catch {}
  }
  items = rawSongs.map((s, idx) => {
    const [title, artist] = splitSong(s);
    return { id: idx, title, artist, elo: 1000, gp: 0, w:0, l:0, t:0 };
  });
  votes = 0; lastMatch = null;
  status('New session');
  save();
}

function save(){
  localStorage.setItem('eloRanker', JSON.stringify({items, votes}));
}

function status(msg){ statusEl.textContent = msg; }

function splitSong(s){
  const parts = s.split(" — ");
  return [parts[0] || s, parts[1] || ""];
}

function expected(a, b){
  return 1 / (1 + Math.pow(10, (b - a)/400));
}

function applyElo(a, b, outcome){ // outcome: 'A','B','T'
  const Ea = expected(a.elo, b.elo);
  const Eb = expected(b.elo, a.elo);
  let Sa=0, Sb=0;
  if (outcome==='A'){ Sa=1; Sb=0; a.w++; b.l++; }
  else if (outcome==='B'){ Sa=0; Sb=1; a.l++; b.w++; }
  else { Sa=0.5; Sb=0.5; a.t++; b.t++; }
  a.elo = round2(a.elo + K*(Sa - Ea));
  b.elo = round2(b.elo + K*(Sb - Eb));
  a.gp++; b.gp++;
}

function round2(x){ return Math.round(x*100)/100; }

function pickPair(){
  // Prefer items with fewer games. Then pick opponent with closest Elo.
  const minGp = Math.min(...items.map(it=>it.gp));
  const pool = items.filter(it => it.gp <= minGp + 2);
  const A = pool[Math.floor(Math.random()*pool.length)];
  // nearest Elo not the same id
  const opponents = items.filter(it => it.id !== A.id);
  opponents.sort((x,y)=>Math.abs(x.elo-A.elo)-Math.abs(y.elo-A.elo));
  const B = opponents[0] || items.find(it=>it.id!==A.id);
  return [A,B];
}

let curA=null, curB=null;

function pickAndRenderPair(){
  [curA, curB] = pickPair();
  lTitle.textContent = curA.title; lArtist.textContent = curA.artist;
  rTitle.textContent = curB.title; rArtist.textContent = curB.artist;
  status(`Vote #${votes+1}`);
  prog.max = Math.max(1, votes+1);
  prog.value = votes;
  progTxt.textContent = `${votes} votes`;
}

function vote(which){
  if (!curA || !curB) return;
  // snapshot for undo
  lastMatch = {
    aId: curA.id, bId: curB.id,
    aElo: curA.elo, bElo: curB.elo,
    aRec:{w:curA.w,l:curA.l,t:curA.t,gp:curA.gp},
    bRec:{w:curB.w,l:curB.l,t:curB.t,gp:curB.gp}
  };
  if (which==='L') applyElo(curA, curB, 'A');
  else if (which==='R') applyElo(curA, curB, 'B');
  else applyElo(curA, curB, 'T');
  votes++;
  save();
  renderRankings();
  pickAndRenderPair();
}

function undo(){
  if (!lastMatch) return;
  const A = items.find(x=>x.id===lastMatch.aId);
  const B = items.find(x=>x.id===lastMatch.bId);
  if (!A || !B) return;
  A.elo = lastMatch.aElo; B.elo = lastMatch.bElo;
  A.w = lastMatch.aRec.w; A.l = lastMatch.aRec.l; A.t = lastMatch.aRec.t; A.gp = lastMatch.aRec.gp;
  B.w = lastMatch.bRec.w; B.l = lastMatch.bRec.l; B.t = lastMatch.bRec.t; B.gp = lastMatch.bRec.gp;
  votes = Math.max(0, votes-1);
  lastMatch = null;
  save();
  renderRankings();
  pickAndRenderPair();
}

function renderRankings(){
  const sorted = items.slice().sort((a,b)=> b.elo - a.elo || a.title.localeCompare(b.title));
  tbody.innerHTML = '';
  sorted.forEach((it, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="rank">${idx+1}</td>
      <td class="song">${escapeHtml(it.title)}</td>
      <td class="artist">${escapeHtml(it.artist)}</td>
      <td class="elo">${it.elo.toFixed(2)}</td>
      <td class="rec">${it.w}-${it.l}-${it.t}</td>
      <td class="gp">${it.gp}</td>
    `;
    tbody.appendChild(tr);
  });
}

function exportCSV(){
  const sorted = items.slice().sort((a,b)=> b.elo - a.elo || a.title.localeCompare(b.title));
  const lines = ["Rank,Song,Artist,Elo,W,L,T,GP"];
  sorted.forEach((it, idx)=>{
    const row = [
      idx+1,
      '"' + it.title.replace(/"/g,'""') + '"',
      '"' + it.artist.replace(/"/g,'""') + '"',
      it.elo.toFixed(2), it.w, it.l, it.t, it.gp
    ].join(',');
    lines.push(row);
  });
  const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = "song_elo.csv";
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
}

function escapeHtml(s){
  return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
}
</script>
</body>
</html>
