<!doctype html>
<html lang="en">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Pairwise Song Ranker</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
  h1 { font-size: 20px; margin: 0 0 8px; }
  .wrap { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
  .card { border: 1px solid #ccc; border-radius: 8px; padding: 16px; min-height: 120px; display: flex; flex-direction: column; justify-content: space-between; }
  .title { font-weight: 600; }
  .btns { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 8px; margin-top: 12px; }
  button { padding: 10px; border-radius: 6px; border: 1px solid #aaa; background: #f5f5f5; cursor: pointer; }
  button.primary { background: #e6f0ff; border-color: #7da6ff; }
  .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
  progress { width: 260px; height: 16px; }
  .small { color: #666; font-size: 12px; }
  ol { padding-left: 20px; }
  .hidden { display: none; }
</style>
<body>
<h1>Pairwise Song Ranker</h1>
<div class="row">
  <button id="reset">Reset</button>
  <button id="export" class="hidden">Export CSV</button>
  <span class="small" id="status">ready</span>
</div>

<div id="compare" class="wrap hidden">
  <div class="card">
    <div class="title" id="leftTitle"></div>
    <div class="small">Press 1</div>
    <button id="leftBtn" class="primary">Choose left</button>
  </div>
  <div class="card">
    <div class="title" id="rightTitle"></div>
    <div class="small">Press 2</div>
    <button id="rightBtn" class="primary">Choose right</button>
  </div>
</div>

<div class="btns hidden" id="actions">
  <button id="tieBtn">Tie (t)</button>
  <button id="skipBtn">Finish now</button>
  <button id="undoBtn">Undo</button>
  <div style="display:flex;align-items:center;gap:8px;">
    <progress id="prog" max="1" value="0"></progress>
    <span class="small" id="progTxt"></span>
  </div>
</div>

<div id="result" class="hidden">
  <h2>Final ranking</h2>
  <ol id="list"></ol>
</div>

<script>
const songs = [
"Feelin' Love - Euphoria Mix* — 22 Interns, Entasia",
"Hold On — 49th & Main, Shee",
"Gimme! Gimme! Gimme! (A Man After Midnight) — ABBA",
"Shoot to Thrill — AC/DC",
"Raving In The Studio — Aitch, Bou",
"Happiness - IN2STELLAR Edit* — Alexis Jordan, IN2STELLAR",
"A Horse With No Name — America",
"Back to Black — Amy Winehouse",
"So Close — Ango",
"I Want Your Soul — Armand Van Helden",
"You Don't Know Me - Radio Edit — Armand Van Helden, Duane Harden",
"Friday (Alone Right Now) — ATRIP",
"The Nights — Avicii",
"Airplanes — B.o.B, Hayley Williams",
"Cherub — Ball Park Music",
"Good Grief — Bastille",
"Frosty — Bebe Stockwell",
"Rust — Ben Böhmer",
"Weightless - jamesjamesjames Remix — Ben Böhmer, Panama, jamesjamesjames",
"Halo — Beyoncé",
"Lanterns — Birds of Tokyo",
"Don't Lie — Black Eyed Peas",
"Meet Me Halfway — Black Eyed Peas",
"Champagne Coast — Blood Orange",
"Mind Loaded — Blood Orange, Caroline Polachek, Lorde, Mustafa",
"The Field — Blood Orange, The Durutti Column, Tariq Al-Sabir, Caroline Polachek, Daniel Caesar",
"From — Bon Iver",
"Make Me - Paul Sirrell Remix — Borai & Denham Audio, Paul Sirrell",
"Missing You — Boston Bun",
"I'm On Fire — Bruce Springsteen",
"Move Your Body — bullet tooth, Xpansions",
"Telling You to Love Me — Butschi",
"Run Away (I Can't Hold You) — CAIVA",
"I'm Not Alone (Radio Edit) — Calvin Harris",
"You Used to Hold Me — Calvin Harris",
"Blessings - KETTAMA Remix — Calvin Harris, Clementine Douglas, KETTAMA",
"I'm Not Alone - MPH Remix — Calvin Harris, MPH",
"CRG — Central Cee, Dave",
"Green Dove — Chaos In The CBD",
"Talk talk — Charli xcx",
"Think I'm In Love With You — Chris Stapleton",
"You Should Probably Leave — Chris Stapleton",
"Desire — Chris Stussy",
"Calendoola — Cloak Bay",
"Come With Me (On a Trip) — Clouds",
"N13 — Cody Wong",
"Hymn for the Weekend — Coldplay",
"Heartbreaker — Crazy P",
"Rain — Creed",
"Bad Moon Rising — Creedence Clearwater Revival",
"Gold BBS — CRUSH3d",
"Something About Us — Daft Punk",
"I Can Wait — Danmic's",
"Emergency — Dart",
"The Color Violet — DATSKO",
"Gettin' Over — David Guetta, Chris Willis, Fergie",
"Runaway - ENW Vs. Darren Jey Mix — Davinah, Darren Jey, ENW",
"Don't Go Away — Demi Riquísimo, The Trip",
"Outnumbered — Dermot Kennedy",
"Baby! — Dijon",
"The Dress — Dijon",
"Latch — Disclosure, Sam Smith",
"Staring Into The Sun — DJ HEARTSTRING",
"Forever (if u need it) — DJ HEARTSTRING, SWIM",
"Wanna Feel — DJ IP & Pegassi",
"Groovejet (If This Ain't Love) — Dj Spiller, Sophie Ellis-Bextor",
"King of Everything — Dominic Fike",
"Skin to Skin — Douvelle19, Kaisha",
"Rain — Dragon",
"Take It Easy — Eagles",
"Tondoho Mba — Eko Roosevelt",
"What U Want - Chris Stussy & Djoko a.k.A Kolter Remix — Enrico Mantini, X Woman, Chris Stussy, Kolter",
"Mona — Entasia",
"Heather Park — Ewan McVicar",
"Crazy — False Persona, Mall Grab",
"Everywhere — Fleetwood Mac",
"The Chain — Fleetwood Mac",
"Stranded — Flight Facilities, BROODS, Reggie Watts, Saro",
"Bug — Fontaines D.C.",
"It's Amazing To Be Young — Fontaines D.C.",
"Call It What You Want — Foster the People",
"Seigfried — Frank Ocean",
"Take Me Out — Franz Ferdinand",
"Tate (how i feel) — Fred again..",
"The Heart Is a Muscle — Gang of Youths",
"Taxes — Geese",
"Tweaker — GELO",
"Keep Me Waiting — George Michelle, Seperate Ways",
"Bamboléo — Gipsy Kings",
"Holiday — Green Day",
"Welcome to the Jungle — Guns N' Roses",
"Battle Scars — Guy Sebastian, Lupe Fiasco",
"What Is Love - 7\" Mix — Haddaway",
"The Nosebleed Section — Hilltop Hoods",
"Benediction — Hot Natured",
"Weathervane — Hunter Metts",
"Do You See What I See? — Hunters & Collectors",
"Holy Grail — Hunters & Collectors",
"Tana’s Home — Idi Akz",
"Perfect Storm — Inhaler",
"You Might Get What You Want — Inhaler",
"Superstar — Jamelia",
"Broken Strings — James Morrison, Nelly Furtado",
"(Don't) Give Hate a Chance — Jamiroquai",
"Domino — Jessie J",
"tell you straight — jigitz",
"Working Class Man — Jimmy Barnes",
"Take Me Home, Country Roads — John Denver",
"Feelings - Radio Edit — John Mood, Janis Zielinski",
"Edge of Desire — Jonas Blue, Malive",
"Love Will Tear Us Apart — Joy Division",
"Lippy — Joy Orbison, Overmono, Skiifall",
"Phantom Pt. II - Soulwax Remix — Justice, Soulwax",
"DAISIES — Justin Bieber",
"Ruby — Kaiser Chiefs",
"ILYSMIH — Kali Uchis",
"Can't Tell Me Nothing — Kanye West",
"Paranoid — Kanye West, Mr Hudson",
"Chemical Thing - Bliss Inc. Remix — Kara Okay, Rob Black, Bliss Inc",
"Underdog — Kasabian",
"I Remember - Radio Edit — Kaskade, deadmau5",
"Somewhere Only We Know — Keane",
"It Gets Better - Forever Mix — KETTAMA",
"3AM - DATSKO Edit* — KETTAMA, DATSKO",
"Yosemite — KETTAMA, Interplanetary Criminal",
"Don't Stop - drums & acid mix — KI/KI",
"All Summer Long — Kid Rock",
"Bette Davis Eyes — Kim Carnes",
"Closer — Kings of Leon",
"Radioactive — Kings of Leon",
"Revelry — Kings of Leon",
"Waste a Moment — Kings of Leon",
"Feel My Desire — Kyle Starkey",
"Timeworn Tech — Kyra Khaldi",
"Bulletproof — La Roux",
"Andromedha* — Lachie Senior",
"My Delirium — Ladyhawke",
"All My Friends — LCD Soundsystem",
"Everything's Electric — Liam Gallagher",
"Baby Pluto — Lil Uzi Vert",
"T.D — Lil Yachty, Tierra Whack, A$AP Rocky, Tyler, The Creator",
"Bleed It Out — Linkin Park",
"What Was That — Lorde",
"Want You In My Soul — Lovebirds, Stee Downes",
"Working for the Weekend — Loverboy",
"all i need — Loyle Carner",
"Where the Wild Things Are — Luke Combs",
"Scotty Doesn't Know — Lustra",
"Dive — Mall Grab",
"Life — Mall Grab",
"Want My Love — Malugi, WOLTERS",
"Dance with Somebody - Radio Version — Mando Diao",
"Freakin' - Original — Marc Romboy, Blake Baxter",
"MJB Da MVP - Alternate Version — Mary J. Blige, 50 Cent",
"DARLING DRIVE — METTE, Sam Gellaitry",
"Lemon Grass — MF DOOM",
"GTA San Adreas Theme - IMMINENT Edit* — Michael Hunter, IMMINENT",
"Dreamworld — Midnight Oil",
"Forgotten Years — Midnight Oil",
"Paddling Out — Miike Snow",
"Cooler Than Me - Single Mix — Mike Posner, Gigamesh",
"See You Again — Miley Cyrus",
"DNM — Mk.gee",
"ROCKMAN — Mk.gee",
"Porcelain — Moby",
"Rollercoaster — Modjo",
"I'm The Problem — Morgan Wallen",
"Just In Case — Morgan Wallen",
"The Future - Purple Disco Machine Remix — Motez, Antony & Cleopatra, Purple Disco Machine",
"Harry and the Jets — Mouseatouille",
"Hopeless Wanderer — Mumford & Sons",
"I Will Wait — Mumford & Sons",
"Snake Eyes — Mumford & Sons",
"You Get What You Give — New Radicals",
"Dream Catch Me — Newton Faulkner",
"I Need You - Twofaced Sport Mix* — Nikita Warren, Twofaced",
"Skyscrapers — Nina Kraviz",
"Acquiesce (Remastered) — Oasis",
"You're Not Alone — Olive",
"Nice To Each Other — Olivia Dean",
"Counting Stars — OneRepublic",
"4EVA — Ordley",
"Gem Lingo (ovr now) — Overmono, Ruthven",
"Turn the Page — Overmono, The Streets",
"Let's Go Swimming — Palace",
"The Sun — Parov Stelar, Graham Candy",
"Picture in my mind — PinkPantheress, Sam Gellaitry",
"Give Me Everything — Pitbull, AFROJACK, Ne-Yo, Nayer",
"Wax — Pocket",
"death bed (coffee for your head) — Powfu, beabadoobee",
"MONDAY — Quadeca",
"Final Answer - Mike Momburg Remix — Radio Cargo, Astrid James, Mike Momburg",
"Empty Words — Radio Free Alice",
"Look What You've Done — Radio Free Alice",
"High and Dry — Radiohead",
"Diamonds - Big Daddy 2022 Bootleg* — Rihanna, DJ Big Daddy From Oslo",
"Her Diamonds — Rob Thomas",
"Show Me Love — Robin S.",
"Dancing On My Own — Robyn",
"Fried Rice — Royel Otis",
"Kool Aid — Royel Otis",
"Like an Animal — RÜFÜS DU SOL",
"Say a Prayer For Me — RÜFÜS DU SOL",
"This Summer — RÜFÜS DU SOL",
"Touch Me - Radio Edit — Rui Da Silva, Cassandra",
"Kiss of Life — Sade",
"Straight and Narrow — Sam Barber",
"All Is On My Side — Sam Fender",
"Hypersonic Missiles — Sam Fender",
"Rein Me In — Sam Fender, Olivia Dean",
"925 — Sammy Virji, Chris Lake, RoRo",
"Arabest — SebastiAn",
"Feel Da Same — Silva Bumpa, Carla Monroe",
"Back 2 Back — Skepta, Fred again..",
"Where You Need To Be — Skin On Skin",
"back to friends — sombr",
"It Feels so Good - The Conductor & the Cowboy Amnesia Mix — Sonique",
"Black Hole Sun — Soundgarden",
"Look Right Through - MK Vocal Edit — Storm Queen, MK",
"Different Time — Swimming Paul",
"Psycho Killer — Talking Heads",
"Somebody Else — The 1975",
"Hey You — The Belair Lip Bombs",
"Look The Part — The Belair Lip Bombs",
"Rock the Casbah (Ranking Roger) — The Clash",
"GO — The Kid LAROI, Juice WRLD",
"All These Things That I've Done — The Killers",
"When You Were Young — The Killers",
"Bad Habit — The Kooks",
"Run Your Mouth — The Marías",
"Such Great Heights — The Postal Service",
"Heaven's on Fire — The Radio Dept.",
"Night Light — The Rions",
"Hall of Fame — The Script, will.i.am",
"Trembling Hands — The Temper Trap",
"Wide open Road — The Triffids",
"Fake Friends — The Vanns",
"Bitter Sweet Symphony — The Verve",
"Under the Pressure — The War on Drugs",
"In The Summertime — Thirsty Merc",
"Mousetrap Heart — Thirsty Merc",
"Need To Know — Tommy Holohan",
"Let me go OH OH — Tove Lo, SG Lewis",
"City of Blinding Lights — U2",
"Vertigo — U2",
"Where the Streets Have No Name — U2",
"Born Slippy (Nuxx) — Underworld",
"Another 9 Days — Vegyn, Ethan P. Flynn",
"mangetout — Wet Leg",
"Drama On The Edge — Willaris. K, Hxxd Gxld",
"Like This — William Kiss",
"Take My Mind — WizTheMc, bees & honey",
"Midas — Wunderhorse",
"Silver — Wunderhorse",
"Teal — Wunderhorse",
"You're Not a Popstar — X CLUB.",
"One More Time (I Need U) — Y U QT",
"You Know What I Want — Y U QT",
"We Come Running — Youngblood Hawke",
"Control — Zoe Wees",
];

// ---------- State ----------
let work = [];       // queue of arrays to merge
let nextWork = [];   // next level merges
let left = null, right = null, i = 0, j = 0, out = [];
let ranked = null;
let history = [];    // for undo
let totalPairs = estimateComparisons(songs.length);
let donePairs = 0;

// ---------- UI ----------
const elLeft = document.getElementById('leftTitle');
const elRight = document.getElementById('rightTitle');
const compareBox = document.getElementById('compare');
const actions = document.getElementById('actions');
const resultBox = document.getElementById('result');
const list = document.getElementById('list');
const statusEl = document.getElementById('status');
const prog = document.getElementById('prog');
const progTxt = document.getElementById('progTxt');
const exportBtn = document.getElementById('export');

document.getElementById('leftBtn').onclick = () => choose(-1);
document.getElementById('rightBtn').onclick = () => choose(1);
document.getElementById('tieBtn').onclick = () => choose(0);
document.getElementById('skipBtn').onclick = finishEarly;
document.getElementById('undoBtn').onclick = undo;
document.getElementById('reset').onclick = () => { localStorage.removeItem('rankerState'); location.reload(); };
exportBtn.onclick = exportCSV;

window.addEventListener('keydown', (e) => {
  if (resultBox.classList.contains('hidden')) {
    if (e.key === '1') choose(-1);
    else if (e.key === '2') choose(1);
    else if (e.key.toLowerCase() === 't') choose(0);
    else if (e.key.toLowerCase() === 'u') undo();
  }
});

// ---------- Init ----------
loadOrFresh();
  
function freshStart() {
  work = songs.map(s => [s]);
  nextWork = [];
  left = null; right = null; i = j = 0; out = [];
  donePairs = 0;
  totalPairs = estimateComparisons(songs.length);
  status('new session');
  compareBox.classList.remove('hidden');
  actions.classList.remove('hidden');
}

function restore(st) {
  ({work, nextWork, left, right, i, j, out, ranked, history, donePairs, totalPairs} = st);
  if (ranked) showResult(ranked);
  else {
    compareBox.classList.remove('hidden');
    actions.classList.remove('hidden');
  }
}

function save() {
  const st = {work, nextWork, left, right, i, j, out, ranked, history, donePairs, totalPairs};
  localStorage.setItem('rankerState', JSON.stringify(st));
}

// ---------- Merge workflow ----------
function nextMerge() {
  if (!left || (i >= left.length && j >= right.length)) {
    // push remaining if any
    if (left && right) {
      if (i < left.length) out.push(...left.slice(i));
      if (j < right.length) out.push(...right.slice(j));
      nextWork.push(out);
    }
    // pull next pair
    left = work.shift() || null;
    right = work.shift() || null;
    i = j = 0; out = [];
    if (!left && !right) {
      // level complete
      if (nextWork.length === 1) {
        ranked = nextWork[0].slice();
        showResult(ranked);
        save();
        return;
      }
      work = nextWork;
      nextWork = [];
      left = work.shift() || null;
      right = work.shift() || null;
      i = j = 0; out = [];
    }
  }
  renderPair();
  save();
}

function renderPair() {
  if (!left || !right) return;
  elLeft.textContent = left[i] ?? '';
  elRight.textContent = right[j] ?? '';
  updateProgress();
  status(`merging: ${left.length} vs ${right.length}`);
}

function choose(cmp) {
  if (!left || !right) return;
  // record for undo
  history.push({cmp, i, j, outLen: out.length});
  if (cmp === -1) { out.push(left[i]); i++; donePairs++; }
  else if (cmp === 1) { out.push(right[j]); j++; donePairs++; }
  else { out.push(left[i]); out.push(right[j]); i++; j++; donePairs++; } // tie counts as one decision
  if (i >= left.length || j >= right.length) {
    // flush remainder and move on in nextMerge()
  }
  if (i < left.length && j < right.length) {
    renderPair();
    save();
  } else {
    nextMerge();
  }
}

function undo() {
  const last = history.pop();
  if (!last) return;
  i = last.i;
  j = last.j;
  out.length = last.outLen;
  donePairs = Math.max(0, donePairs - 1);
  renderPair();
  save();
}

function finishEarly() {
  // Complete current merge quickly then flatten remaining
  if (left) out.push(...(left.slice(i)));
  if (right) out.push(...(right.slice(j)));
  nextWork.push(out);
  // flatten remaining work levels
  const flat = [...nextWork, ...work].flat();
  ranked = flat;
  showResult(ranked);
  save();
}

// ---------- UI helpers ----------
function showResult(arr) {
  compareBox.classList.add('hidden');
  actions.classList.add('hidden');
  resultBox.classList.remove('hidden');
  exportBtn.classList.remove('hidden');
  list.innerHTML = '';
  arr.forEach((s, idx) => {
    const li = document.createElement('li');
    li.textContent = s;
    list.appendChild(li);
  });
  status('done');
}

function updateProgress() {
  // crude estimate: comparisons ~ n * log2(n). Track decisions made.
  prog.max = totalPairs || 1;
  prog.value = Math.min(donePairs, prog.max);
  const pct = Math.min(100, Math.round((prog.value / prog.max) * 100));
  progTxt.textContent = `${pct}%`;
}

function estimateComparisons(n) {
  // Approx upper bound for merge sort: n * ceil(log2 n)
  return n * Math.ceil(Math.log2(Math.max(1, n)));
}

function status(msg) { statusEl.textContent = msg; }

// ---------- kick ----------
nextMerge();
</script>
</body>
</html>
